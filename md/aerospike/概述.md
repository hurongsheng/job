### 介绍

#### Aerospike是一个分布式，可扩展的NoSQL数据库。该架构有三个主要目标：

- 为Web级应用程序创建灵活，可扩展的平台。

- 提供传统数据库所期望的可用性和可靠性（如ACID）。

- 以最少的人工参与提供运营效率。

#### Aerospike 包含了三层架构

   ![架构图](https://www.aerospike.com/docs/architecture/assets/as-architecture.png '')

- 客户端层：
    此群集感知层包括开源客户端库，这些库实现了Aerospike API，跟踪节点并知道数据在群集中的位置。
- 群集和数据分发层：
    该层管理群集通信，并自动执行故障转移，复制，跨数据中心复制（XDR）以及智能的重新平衡和数据迁移。
- 数据存储层：
    该层将数据可靠地存储在DRAM和Flash中，以便快速检索。

### 客户端层

- 实现Aerospike API、客户端-服务器传输协议，并直接与集群对话。
- 跟踪节点并知道数据存储在哪里，及时了解集群配置的变更或节点的启动或关闭。
- 实现自有的TCP/IP连接池。 还可以监测尚未上升到集群中节点故障级别的事务故障，并将这些事务重新路由到具有数据副本的节点。
- 将请求直接与数据透明地发送到节点，并根据需要重试或重新路由请求（例如，在集群重新配置期间）。
    
### 分发层
   
    Aerospike的无共享架构旨在通过自动故障转移，复制和跨数据中心复制（XDR）可靠地存储TB级数据。 该层线性缩放。
    
    分布层旨在通过所有集群管理功能的系统自动化来消除人工运维。 
    
   
   >（无共享架构：是一 种分布式计算架构。这种架构中的每一个节点（ node）都是独立、自给的，而且整个系统中没有单点竞争。有些系统需要集中保存大量的状态信息如数据库、应用服务器或是其他类似的单点竞争系统)

#### 它包括三个模块：

- 群集管理模块：跟踪群集中的节点。 关键算法是基于Paxos的gossip投票，该过程确定哪些节点被视为群集的一部分。 Aerospike实现了特殊的心跳检测（主动和被动）来监视节点间的连接。
- 数据迁移模块：添加或删除节点时，Aerospike会确定集群成员身份。 每个节点使用分布式哈希算法将主键索引空间划分为数据切片并分配所有者。 Aerospike数据迁移模块可智能地均衡群集中所有节点之间的数据分布，从而确保数据的每一位都能在所有群集节点和数据中心之间复制。 此操作在系统复制因子配置中指定。
- 事务处理模块：根据请求读取和写入数据，并提供一致性和隔离性保证。包含了同步/异步的复制、代理、和解决数据冲突


  >（一旦数据中心启动，你就可以用户无感的增加集群和夸数据中心复制）
    
### 数据存储层

    Aerospike是具有无模式数据模型的键值存储。
    数据存在策略容器，名称空间，这些在语义上类似于RDBMS系统中的数据库。 
    在名称空间(RDBMS database)中，数据可细分为sets（RDBMS table）和records（RDBMS rows）。
    每条record在set中都有唯一的索引键，以及一个或多个bin（RDBMS columns），其中包含与该记录关联的值。
    
> (Schemaless 指无需定义诸如数据库，表结构等信息的存储模式)
>> 数据层旨在提高速度并大幅降低硬件成本。 它可以在所有内存中运行，从而消除了对缓存层的需求，或者可以利用闪存的独特优化功能。 无论哪种方式，数据都不会丢失。

#### 存储要求

- 对于存储层，索引可以存在内存或闪存中，小的命名空间可以存在更快的内存中，数据较大可以选择存在更经济的ssd中
- 1亿个key仅占用6.4GB。 尽管key没有大小限制，但是每个key最多存储在64个字节中。
- 整块的去读写可以减少延时

Smart Defragmenter和Evictor共同工作，以确保DRAM中有空间，并且数据永远不会丢失，并且始终安全地写入磁盘。
Smart Defragmenter智能碎片整理程序：跟踪每个块中活动记录的数量，并回收低于最低使用级别的块。
Evictor驱逐者：如果系统超出设置的最高水位标记，则删除过期的记录并回收内存。 过期时间是按名称空间配置的。 记录寿命是从上次修改开始计算的。 该应用程序可以覆盖默认生存期，并指定永远不要驱逐记录。

### 其他

- 更改配置无需重启即可自动更新

### 关键概念

- shared nothing architecture 无共享架构 
- Schemaless data model 无模式数据模型

### 问题

- 同一个bin是否可以不同类型 -- 可以
- 每个key是固定64字节还是最多64字节

